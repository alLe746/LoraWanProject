#include <AES.h>

AES aes ;

byte key[] =
{
  0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
} ; //key, a mettre LA MEME dans toutes les sodaq

byte plain[] =
{
  0xf3, 0x44, 0x81, 0xec, 0x3c, 0xc6, 0x27, 0xba, 0xcd, 0x5d, 0xc3, 0xfb, 0x08, 0xf2, 0x73, 0xe6,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
} ; //le texte a envoyer (peut etre n'importe quoi, juste à transformer en byte[] si c'est un string)

byte my_iv[] =
{
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
} ; //osef

byte cipher [4 * N_BLOCK] ; //le truc crypté à envoyer
byte check [4 * N_BLOCK] ; //le truc decrypté après la réception

void loop ()
{}


void setup ()
{
  Serial.begin (57600) ;
  Serial.print ("testng mode") ;

  test () ;

  //  otfly_test () ;
  //  otfly_test256 () ;
}
void key_setting()
{
  aes.set_key (key, 256);
}
void cryptage ()
{
  aes.encrypt (plain, cipher);
}
void decryptage()
{
  aes.decrypt (cipher, check);
}
void affichage()
{
  for (byte ph = 0 ; ph < 3 ; ph++)
  {
    Serial.println(ph);
    for (byte i = 0 ; i < sizeof(plain)/sizeof(plain[0]) ; i++)
    {
      byte val = ph == 0 ? plain[i] : ph == 1 ? cipher[i] : ph == 2 ? check[i] : 0;
      Serial.print (val >> 4, HEX) ; Serial.print (val & 15, HEX) ; Serial.print (" ") ;
    }
    Serial.println () ;
  }
}

void test ()
{
  key_setting();
  cryptage();
  decryptage();
  affichage();
}
